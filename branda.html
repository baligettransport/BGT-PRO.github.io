<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BGT-PRO - Portal Anggota</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --dark-card: #1e293b;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --light: #f1f5f9;
            --white: #ffffff;
            --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
            --gradient-dark: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            --gradient-pink: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
            --gradient-green: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            --gradient-orange: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.1);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --radius: 16px;
            --radius-lg: 24px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
            min-height: 100%;
            min-height: 100dvh;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: 100dvh;
            background: var(--gradient-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-logo {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: pulse-glow 2s infinite;
        }

        .loading-logo i {
            font-size: 2rem;
            color: white;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 0 0 20px rgba(99, 102, 241, 0); }
        }

        .loading-spinner {
            width: 35px;
            height: 35px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray-light);
            font-size: 0.85rem;
        }

        /* App Container */
        .app-container {
            width: 100%;
            min-height: 100%;
            min-height: 100dvh;
            padding-bottom: 80px;
        }

        /* Page Container */
        .page {
            display: none;
            width: 100%;
            min-height: 100%;
            min-height: 100dvh;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.98) 0%, rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .back-btn, .menu-btn {
            width: 38px;
            height: 38px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .back-btn:active, .menu-btn:active {
            background: rgba(255,255,255,0.15);
            transform: scale(0.95);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notif-btn {
            width: 38px;
            height: 38px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            position: relative;
        }

        .notif-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            min-width: 16px;
            height: 16px;
            background: var(--danger);
            border-radius: 50%;
            font-size: 0.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
        }

        .notif-badge.hidden {
            display: none;
        }

        /* Profile Card */
        .profile-card {
            margin: 16px;
            background: var(--gradient-primary);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -15%;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .profile-card::after {
            content: '';
            position: absolute;
            bottom: -25%;
            left: -8%;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
        }

        .profile-content {
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-avatar {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            object-fit: cover;
            flex-shrink: 0;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .profile-title {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .profile-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.9);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.9); }
        }

        .profile-qr {
            width: 45px;
            height: 45px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.3rem;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .profile-qr:active {
            transform: scale(0.95);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 0 16px 16px;
        }

        .stat-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 12px 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .stat-card:active {
            border-color: var(--primary);
            transform: scale(0.98);
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            margin: 0 auto 8px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .stat-icon.location { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .stat-icon.members { background: rgba(99, 102, 241, 0.15); color: var(--primary); }
        .stat-icon.events { background: rgba(245, 158, 11, 0.15); color: var(--accent); }

        .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--gray-light);
        }

        /* Section Title */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            margin-bottom: 12px;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title i {
            color: var(--primary);
            font-size: 0.9rem;
        }

        .section-link {
            font-size: 0.8rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        /* Feature Menu */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 0 16px 20px;
        }

        .feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .feature-icon {
            width: 55px;
            height: 55px;
            background: var(--dark-light);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }

        .feature-item:active .feature-icon {
            transform: scale(0.95);
            border-color: var(--primary);
        }

        .feature-icon.kopdar { color: #f472b6; }
        .feature-icon.promo { color: #fbbf24; }
        .feature-icon.location { color: #34d399; }
        .feature-icon.chat { color: #60a5fa; }
        .feature-icon.settings { color: #a78bfa; }
        .feature-icon.history { color: #fb923c; }
        .feature-icon.help { color: #2dd4bf; }
        .feature-icon.share { color: #f87171; }

        .feature-label {
            font-size: 0.7rem;
            color: var(--gray-light);
            text-align: center;
            font-weight: 500;
        }

        /* Promo Slider - AUTO SCROLL */
        .promo-slider-wrapper {
            margin: 0 0 20px;
            overflow: hidden;
        }

        .promo-slider {
            display: flex;
            gap: 12px;
            padding: 0 16px;
            animation: autoScroll 20s linear infinite;
        }

        .promo-slider:hover {
            animation-play-state: paused;
        }

        @keyframes autoScroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .promo-card {
            min-width: 280px;
            height: 160px;
            border-radius: 18px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .promo-card:active {
            transform: scale(0.98);
        }

        .promo-card.promo-1 { background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%); }
        .promo-card.promo-2 { background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%); }
        .promo-card.promo-3 { background: linear-gradient(135deg, #10b981 0%, #34d399 100%); }
        .promo-card.promo-4 { background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%); }

        .promo-card::before {
            content: '';
            position: absolute;
            top: -25%;
            right: -8%;
            width: 120px;
            height: 120px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .promo-image {
            position: absolute;
            right: 12px;
            bottom: 12px;
            width: 85px;
            height: 85px;
            border-radius: 12px;
            object-fit: cover;
            opacity: 0.9;
        }

        .promo-badge {
            display: inline-block;
            background: rgba(255,255,255,0.25);
            padding: 3px 10px;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .promo-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: 4px;
            max-width: 160px;
        }

        .promo-desc {
            font-size: 0.8rem;
            opacity: 0.9;
            max-width: 150px;
            line-height: 1.3;
        }

        /* Promo Dots */
        .promo-dots {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
        }

        .promo-dot {
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.3s;
        }

        .promo-dot.active {
            width: 18px;
            border-radius: 3px;
            background: var(--primary);
        }

        /* Kopdar Section */
        .kopdar-list {
            margin: 0 16px 20px;
        }

        .kopdar-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            gap: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .kopdar-card:active {
            border-color: var(--primary);
            transform: scale(0.99);
        }

        .kopdar-image {
            width: 75px;
            height: 75px;
            border-radius: 10px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .kopdar-info {
            flex: 1;
        }

        .kopdar-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }

        .kopdar-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 6px;
        }

        .kopdar-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: var(--gray-light);
        }

        .kopdar-meta i {
            font-size: 0.7rem;
            color: var(--primary);
        }

        .kopdar-badge {
            display: inline-block;
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
            font-weight: 600;
        }

        .kopdar-badge.soon {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent);
        }

        .kopdar-badge.open {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 8px 16px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 6px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item i {
            font-size: 1.15rem;
        }

        .nav-item span {
            font-size: 0.65rem;
            font-weight: 500;
        }

        /* Side Menu Overlay */
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: 100dvh;
            background: rgba(0,0,0,0.6);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .side-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .side-menu {
            position: fixed;
            top: 0;
            left: -280px;
            width: 280px;
            height: 100%;
            height: 100dvh;
            background: var(--dark-light);
            z-index: 201;
            transition: left 0.3s ease;
            overflow-y: auto;
        }

        .side-menu.active {
            left: 0;
        }

        .menu-header {
            padding: 25px 18px;
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .menu-header::before {
            content: '';
            position: absolute;
            top: -40%;
            right: -25%;
            width: 150px;
            height: 150px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .menu-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .menu-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            object-fit: cover;
        }

        .menu-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .menu-title {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .menu-close {
            position: absolute;
            top: 15px;
            right: 12px;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .menu-items {
            padding: 15px 0;
        }

        .menu-section {
            padding: 10px 18px;
            font-size: 0.7rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .menu-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 18px;
            color: var(--white);
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }

        .menu-link:active {
            background: rgba(255,255,255,0.05);
        }

        .menu-link i {
            width: 18px;
            text-align: center;
            color: var(--primary);
            font-size: 0.95rem;
        }

        .menu-link span {
            flex: 1;
            font-size: 0.9rem;
        }

        .menu-link .arrow {
            color: var(--gray);
            font-size: 0.7rem;
        }

        /* Permission Overlay */
        .permission-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: 100dvh;
            background: var(--gradient-dark);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .permission-card {
            background: var(--dark-light);
            border-radius: var(--radius-lg);
            padding: 25px;
            width: 100%;
            max-width: 340px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .permission-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .permission-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 1.8rem;
        }

        .permission-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .permission-subtitle {
            font-size: 0.8rem;
            color: var(--gray-light);
        }

        .permission-list {
            margin-bottom: 18px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .permission-item.granted {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .permission-item.denied {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .permission-item-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .permission-item.granted .permission-item-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .permission-item.denied .permission-item-icon {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .permission-item-info {
            flex: 1;
        }

        .permission-item-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .permission-item-desc {
            font-size: 0.7rem;
            color: var(--gray-light);
        }

        .permission-item-status {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: var(--radius-full);
        }

        .permission-item-status.granted {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .permission-item-status.denied {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .permission-item-status.pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent);
        }

        .permission-btn {
            width: 100%;
            padding: 13px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .permission-btn:active {
            transform: scale(0.98);
        }

        .permission-btn.secondary {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.2);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 46px;
            height: 24px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.1);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--success);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        /* Settings Section */
        .settings-section {
            margin: 0 16px 20px;
        }

        .settings-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .setting-item:first-child {
            padding-top: 4px;
        }

        .setting-item:last-child {
            border-bottom: none;
            padding-bottom: 4px;
        }

        .setting-info {
            flex: 1;
        }

        .setting-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .setting-desc {
            font-size: 0.7rem;
            color: var(--gray-light);
        }

        /* Location Card */
        .location-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.05);
            margin-bottom: 15px;
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .location-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .location-title i {
            color: var(--success);
        }

        .location-status {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .location-status.active {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .location-status.inactive {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .location-coords {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .coord-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .coord-row:last-child {
            margin-bottom: 0;
        }

        .coord-label {
            color: var(--gray-light);
        }

        .coord-value {
            font-weight: 600;
            font-family: monospace;
        }

        .btn-update-location {
            width: 100%;
            padding: 12px;
            background: var(--gradient-primary);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-update-location:active {
            transform: scale(0.98);
        }

        .btn-update-location:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Info Banner */
        .info-banner {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-top: 12px;
            font-size: 0.75rem;
            line-height: 1.4;
            color: var(--gray-light);
        }

        .info-banner i {
            color: var(--accent);
            margin-right: 4px;
        }

        .info-banner.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .info-banner.success i {
            color: var(--success);
        }

        /* Profile Page */
        .profile-page-card {
            margin: 16px;
            background: var(--dark-light);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .profile-cover {
            height: 120px;
            background: var(--gradient-primary);
            position: relative;
        }

        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid var(--dark-light);
            object-fit: cover;
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
        }

        .profile-details {
            padding: 60px 18px 20px;
            text-align: center;
        }

        .profile-details-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profile-details-title {
            display: inline-block;
            background: var(--gradient-primary);
            padding: 5px 16px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 18px;
        }

        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            text-align: left;
            margin-top: 18px;
        }

        .profile-info-item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 10px;
        }

        .profile-info-item label {
            font-size: 0.7rem;
            color: var(--gray-light);
            display: block;
            margin-bottom: 4px;
        }

        .profile-info-item span {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Promo List Page */
        .promo-list {
            margin: 16px;
        }

        .promo-item {
            background: var(--dark-light);
            border-radius: var(--radius);
            margin-bottom: 12px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .promo-item-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .promo-item-content {
            padding: 12px;
        }

        .promo-item-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .promo-item-desc {
            font-size: 0.8rem;
            color: var(--gray-light);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .promo-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .promo-item-date {
            font-size: 0.7rem;
            color: var(--gray);
        }

        .promo-item-btn {
            background: var(--gradient-primary);
            border: none;
            padding: 7px 14px;
            border-radius: 8px;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 70px;
            right: 12px;
            left: 12px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            pointer-events: none;
        }

        .toast {
            background: var(--dark-light);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 12px 14px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow-xl);
            pointer-events: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .toast.hiding {
            animation: slideOut 0.3s ease forwards;
        }

        @keyframes slideOut {
            to {
                transform: translateY(-20px);
                opacity: 0;
            }
        }

        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .toast-icon.success { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .toast-icon.info { background: rgba(99, 102, 241, 0.15); color: var(--primary); }
        .toast-icon.warning { background: rgba(245, 158, 11, 0.15); color: var(--accent); }

        .toast-content { flex: 1; }

        .toast-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: 0.75rem;
            color: var(--gray-light);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 4px;
            font-size: 0.8rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-light);
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 0.85rem;
        }

        /* Notification List */
        .notif-list {
            margin: 16px;
        }

        .notif-card {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            gap: 12px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .notif-icon {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .notif-info { flex: 1; }

        .notif-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .notif-message {
            font-size: 0.75rem;
            color: var(--gray-light);
            margin-bottom: 4px;
        }

        .notif-time {
            font-size: 0.65rem;
            color: var(--gray);
        }
    </style>
</head>
<body>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-truck"></i>
        </div>
        <div class="loading-spinner"></div>
        <p class="loading-text">Memuat BGT-PRO...</p>
    </div>

    <!-- Permission Overlay -->
    <div class="permission-overlay" id="permissionOverlay">
        <div class="permission-card">
            <div class="permission-header">
                <div class="permission-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2 class="permission-title">Izin Aplikasi</h2>
                <p class="permission-subtitle">BGT-PRO membutuhkan izin untuk berfungsi optimal</p>
            </div>

            <div class="permission-list">
                <div class="permission-item" id="perm-location">
                    <div class="permission-item-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="permission-item-info">
                        <div class="permission-item-title">Lokasi</div>
                        <div class="permission-item-desc">Untuk menampilkan posisi Anda</div>
                    </div>
                    <span class="permission-item-status pending" id="status-location">Menunggu</span>
                </div>

                <div class="permission-item" id="perm-notification">
                    <div class="permission-item-icon">
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="permission-item-info">
                        <div class="permission-item-title">Notifikasi</div>
                        <div class="permission-item-desc">Info update & pesan</div>
                    </div>
                    <span class="permission-item-status pending" id="status-notification">Menunggu</span>
                </div>
            </div>

            <button class="permission-btn" id="btnRequestPermissions" onclick="requestAllPermissions()">
                <i class="fas fa-check-circle"></i> Izinkan Semua
            </button>
            <button class="permission-btn secondary" onclick="skipPermissions()">
                Lewati untuk Sekarang
            </button>
        </div>
    </div>

    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay" id="menuOverlay" onclick="closeMenu()"></div>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="menu-header">
            <button class="menu-close" onclick="closeMenu()">
                <i class="fas fa-times"></i>
            </button>
            <div class="menu-profile">
                <img src="" alt="Avatar" class="menu-avatar" id="menuAvatar">
                <div>
                    <div class="menu-name" id="menuName">Loading...</div>
                    <div class="menu-title" id="menuTitle">-</div>
                </div>
            </div>
        </div>

        <div class="menu-items">
            <div class="menu-section">Menu Utama</div>
            <a class="menu-link" onclick="closeMenu(); navigateTo('home');">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
            <a class="menu-link" onclick="closeMenu(); navigateTo('profile');">
                <i class="fas fa-user"></i>
                <span>Profil Saya</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
            <a class="menu-link" onclick="closeMenu(); navigateTo('kopdar');">
                <i class="fas fa-calendar-alt"></i>
                <span>Jadwal Kopdar</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
            <a class="menu-link" onclick="closeMenu(); navigateTo('promo');">
                <i class="fas fa-tags"></i>
                <span>Promo & Diskon</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>

            <div class="menu-section">Lainnya</div>
            <a class="menu-link" onclick="closeMenu(); navigateTo('settings');">
                <i class="fas fa-cog"></i>
                <span>Pengaturan</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
            <a class="menu-link" onclick="closeMenu(); navigateTo('help');">
                <i class="fas fa-question-circle"></i>
                <span>Bantuan</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
            <a class="menu-link" onclick="handleLogout()" style="color: var(--danger);">
                <i class="fas fa-sign-out-alt" style="color: var(--danger);"></i>
                <span>Keluar</span>
                <i class="fas fa-chevron-right arrow"></i>
            </a>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container" id="mainApp" style="display: none;">

        <!-- ==================== HOME PAGE ==================== -->
        <div class="page active" id="page-home">
            <header class="header">
                <div class="header-left">
                    <button class="menu-btn" onclick="openMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-title">BGT-PRO</div>
                </div>
                <div class="header-right">
                    <button class="notif-btn" onclick="navigateTo('notifications')">
                        <i class="fas fa-bell"></i>
                        <span class="notif-badge hidden" id="notifBadge">0</span>
                    </button>
                </div>
            </header>

            <!-- Profile Card -->
            <div class="profile-card" onclick="navigateTo('profile')">
                <div class="profile-content">
                    <img src="" alt="Avatar" class="profile-avatar" id="userAvatar">
                    <div class="profile-info">
                        <h2 class="profile-name" id="userName">Loading...</h2>
                        <div class="profile-title">
                            <i class="fas fa-crown"></i>
                            <span id="userTitle">-</span>
                        </div>
                        <div class="profile-status">
                            <span class="status-dot"></span>
                            <span id="userStatus">ONLINE</span>
                        </div>
                    </div>
                    <div class="profile-qr">
                        <i class="fas fa-qrcode"></i>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card" onclick="navigateTo('settings')">
                    <div class="stat-icon location">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="stat-value" id="statLocation">-</div>
                    <div class="stat-label">Lokasi</div>
                </div>
                <div class="stat-card" onclick="navigateTo('members')">
                    <div class="stat-icon members">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value" id="statMembers">0</div>
                    <div class="stat-label">Anggota</div>
                </div>
                <div class="stat-card" onclick="navigateTo('kopdar')">
                    <div class="stat-icon events">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-value" id="statEvents">0</div>
                    <div class="stat-label">Event</div>
                </div>
            </div>

            <!-- Feature Menu -->
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-th-large"></i>
                    Menu Cepat
                </h3>
            </div>
            <div class="feature-grid">
                <div class="feature-item" onclick="navigateTo('kopdar')">
                    <div class="feature-icon kopdar">
                        <i class="fas fa-mug-hot"></i>
                    </div>
                    <span class="feature-label">Kopdar</span>
                </div>
                <div class="feature-item" onclick="navigateTo('promo')">
                    <div class="feature-icon promo">
                        <i class="fas fa-percent"></i>
                    </div>
                    <span class="feature-label">Promo</span>
                </div>
                <div class="feature-item" onclick="navigateTo('settings')">
                    <div class="feature-icon location">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <span class="feature-label">Lokasi</span>
                </div>
                <div class="feature-item" onclick="navigateTo('chat')">
                    <div class="feature-icon chat">
                        <i class="fas fa-comments"></i>
                    </div>
                    <span class="feature-label">Chat</span>
                </div>
                <div class="feature-item" onclick="navigateTo('history')">
                    <div class="feature-icon history">
                        <i class="fas fa-history"></i>
                    </div>
                    <span class="feature-label">Riwayat</span>
                </div>
                <div class="feature-item" onclick="navigateTo('settings')">
                    <div class="feature-icon settings">
                        <i class="fas fa-cog"></i>
                    </div>
                    <span class="feature-label">Pengaturan</span>
                </div>
                <div class="feature-item" onclick="navigateTo('help')">
                    <div class="feature-icon help">
                        <i class="fas fa-headset"></i>
                    </div>
                    <span class="feature-label">Bantuan</span>
                </div>
                <div class="feature-item" onclick="shareApp()">
                    <div class="feature-icon share">
                        <i class="fas fa-share-alt"></i>
                    </div>
                    <span class="feature-label">Bagikan</span>
                </div>
            </div>

            <!-- Promo Slider - AUTO SCROLL -->
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-fire"></i>
                    Promo Spesial
                </h3>
                <span class="section-link" onclick="navigateTo('promo')">Lihat Semua</span>
            </div>
            <div class="promo-slider-wrapper">
                <div class="promo-slider" id="promoSliderHome">
                    <!-- Promo cards will be loaded here -->
                </div>
            </div>

            <!-- Kopdar Section -->
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    Kopdar Mendatang
                </h3>
                <span class="section-link" onclick="navigateTo('kopdar')">Lihat Semua</span>
            </div>
            <div class="kopdar-list" id="kopdarListHome">
                <!-- Kopdar cards will be loaded here -->
            </div>
        </div>

        <!-- ==================== PROFILE PAGE ==================== -->
        <div class="page" id="page-profile">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Profil Saya</div>
                </div>
            </header>

            <div class="profile-page-card">
                <div class="profile-cover">
                    <img src="" alt="Avatar" class="profile-avatar-large" id="profileAvatarLarge">
                </div>
                <div class="profile-details">
                    <h2 class="profile-details-name" id="profileName">-</h2>
                    <span class="profile-details-title" id="profileTitle">-</span>
                    
                    <div class="profile-info-grid">
                        <div class="profile-info-item">
                            <label><i class="fas fa-envelope"></i> Email</label>
                            <span id="profileEmail">-</span>
                        </div>
                        <div class="profile-info-item">
                            <label><i class="fas fa-phone"></i> Telepon</label>
                            <span id="profilePhone">-</span>
                        </div>
                        <div class="profile-info-item">
                            <label><i class="fas fa-car"></i> Plat Mobil</label>
                            <span id="profilePlat">-</span>
                        </div>
                        <div class="profile-info-item">
                            <label><i class="fas fa-calendar"></i> Bergabung</label>
                            <span id="profileJoined">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== KOPDAR PAGE ==================== -->
        <div class="page" id="page-kopdar">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Jadwal Kopdar</div>
                </div>
            </header>

            <div class="kopdar-list" id="kopdarListFull" style="margin-top: 16px; margin-left: 16px; margin-right: 16px;">
                <!-- Kopdar cards will be loaded here -->
            </div>
        </div>

        <!-- ==================== PROMO PAGE ==================== -->
        <div class="page" id="page-promo">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Promo & Diskon</div>
                </div>
            </header>

            <div class="promo-list" id="promoListFull" style="margin-top: 16px;">
                <!-- Promo items will be loaded here -->
            </div>
        </div>

        <!-- ==================== SETTINGS PAGE ==================== -->
        <div class="page" id="page-settings">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Pengaturan</div>
                </div>
            </header>

            <!-- Location Section -->
            <div class="section-header" style="margin-top: 16px;">
                <h3 class="section-title">
                    <i class="fas fa-location-arrow"></i>
                    Lokasi
                </h3>
            </div>
            <div class="settings-section">
                <div class="location-card">
                    <div class="location-header">
                        <div class="location-title">
                            <i class="fas fa-satellite-dish"></i>
                            <span>Status GPS</span>
                        </div>
                        <div class="location-status inactive" id="locationStatus">
                            <i class="fas fa-circle"></i>
                            <span id="locationStatusText">Tidak Aktif</span>
                        </div>
                    </div>
                    <div class="location-coords">
                        <div class="coord-row">
                            <span class="coord-label">Latitude</span>
                            <span class="coord-value" id="latValue">-</span>
                        </div>
                        <div class="coord-row">
                            <span class="coord-label">Longitude</span>
                            <span class="coord-value" id="lngValue">-</span>
                        </div>
                        <div class="coord-row">
                            <span class="coord-label">Update Terakhir</span>
                            <span class="coord-value" id="locationTime">-</span>
                        </div>
                    </div>
                    <button class="btn-update-location" id="btnUpdateLocation" onclick="updateLocation()">
                        <i class="fas fa-sync-alt"></i>
                        <span id="btnLocationText">Update Lokasi</span>
                    </button>
                </div>
            </div>

            <!-- App Settings -->
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-sliders-h"></i>
                    Pengaturan Aplikasi
                </h3>
            </div>
            <div class="settings-section">
                <div class="settings-card">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Background Location</div>
                            <div class="setting-desc">Update lokasi saat di background</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleBackgroundLocation" onchange="toggleBackgroundLocation(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">High Accuracy GPS</div>
                            <div class="setting-desc">Gunakan GPS presisi tinggi</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleHighAccuracy" onchange="toggleHighAccuracy(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title">Notifikasi dengan Suara</div>
                            <div class="setting-desc">Bunyikan suara saat ada notifikasi</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleNotif" onchange="toggleNotification(this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="info-banner" id="settingsInfoBanner">
                        <i class="fas fa-info-circle"></i>
                        Aktifkan notifikasi untuk mendapat info terbaru
                    </div>
                </div>
            </div>

            <!-- Account Info -->
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-user-cog"></i>
                    Akun
                </h3>
            </div>
            <div class="settings-section">
                <div class="settings-card">
                    <div class="setting-item" onclick="showPermissionOverlay()" style="cursor: pointer;">
                        <div class="setting-info">
                            <div class="setting-title">Kelola Izin Aplikasi</div>
                            <div class="setting-desc">Atur izin lokasi, notifikasi, dll</div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--gray);"></i>
                    </div>
                    <div class="setting-item" onclick="handleLogout()" style="cursor: pointer;">
                        <div class="setting-info">
                            <div class="setting-title" style="color: var(--danger);">Keluar dari Akun</div>
                            <div class="setting-desc">Logout dari aplikasi BGT-PRO</div>
                        </div>
                        <i class="fas fa-sign-out-alt" style="color: var(--danger);"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== NOTIFICATIONS PAGE ==================== -->
        <div class="page" id="page-notifications">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Notifikasi</div>
                </div>
            </header>

            <div class="notif-list" id="notificationList">
                <!-- Notifications will be loaded here -->
            </div>
        </div>

        <!-- ==================== HELP PAGE ==================== -->
        <div class="page" id="page-help">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Bantuan</div>
                </div>
            </header>

            <div class="settings-section" style="margin-top: 16px;">
                <div class="settings-card">
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title"><i class="fas fa-question-circle" style="color: var(--primary); margin-right: 6px;"></i> FAQ</div>
                            <div class="setting-desc">Pertanyaan yang sering ditanyakan</div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--gray);"></i>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title"><i class="fas fa-phone" style="color: var(--success); margin-right: 6px;"></i> Hubungi Admin</div>
                            <div class="setting-desc">WhatsApp: +62 812-3456-7890</div>
                        </div>
                        <i class="fas fa-external-link-alt" style="color: var(--gray);"></i>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-title"><i class="fas fa-info-circle" style="color: var(--info); margin-right: 6px;"></i> Tentang Aplikasi</div>
                            <div class="setting-desc">BGT-PRO v1.0.0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== OTHER PAGES ==================== -->
        <div class="page" id="page-members">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Daftar Anggota</div>
                </div>
            </header>
            <div class="empty-state" style="padding-top: 50px;">
                <i class="fas fa-users"></i>
                <p>Fitur daftar anggota akan segera hadir</p>
            </div>
        </div>

        <div class="page" id="page-chat">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Chat</div>
                </div>
            </header>
            <div class="empty-state" style="padding-top: 50px;">
                <i class="fas fa-comments"></i>
                <p>Fitur chat akan segera hadir</p>
            </div>
        </div>

        <div class="page" id="page-history">
            <header class="header">
                <div class="header-left">
                    <button class="back-btn" onclick="navigateTo('home')">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-title">Riwayat</div>
                </div>
            </header>
            <div class="empty-state" style="padding-top: 50px;">
                <i class="fas fa-history"></i>
                <p>Fitur riwayat akan segera hadir</p>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-item active" data-page="home" onclick="navigateTo('home')">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
            </div>
            <div class="nav-item" data-page="kopdar" onclick="navigateTo('kopdar')">
                <i class="fas fa-calendar-alt"></i>
                <span>Kopdar</span>
            </div>
            <div class="nav-item" data-page="promo" onclick="navigateTo('promo')">
                <i class="fas fa-tags"></i>
                <span>Promo</span>
            </div>
            <div class="nav-item" data-page="profile" onclick="navigateTo('profile')">
                <i class="fas fa-user"></i>
                <span>Profil</span>
            </div>
        </nav>

    </div>

    <!-- Audio for notification sound -->
    <audio id="notifSound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
    </audio>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCahZIFKFXMCokFNxCpFokNSVtKzN4llus",
            authDomain: "cedar-setup-425414-d7.firebaseapp.com",
            databaseURL: "https://cedar-setup-425414-d7-default-rtdb.firebaseio.com",
            projectId: "cedar-setup-425414-d7",
            storageBucket: "cedar-setup-425414-d7.firebasestorage.app",
            messagingSenderId: "723545991983",
            appId: "1:723545991983:web:379548d2b425a502a60fda",
            measurementId: "G-FPL6PF3KWJ"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userSessionUnsubscribe = null;
        let watchPositionId = null;
        let lastActiveInterval = null;
        let notificationsUnsubscribe = null;

        // App Settings
        let appSettings = {
            backgroundLocation: false,
            highAccuracy: true,
            notification: false
        };

        // Permission Status
        let permissionStatus = {
            location: 'pending',
            notification: 'pending'
        };

        // Sample Data
        let promoData = [
            {
                id: 1,
                title: 'Kopdar Bulanan',
                desc: 'Diskon 20% untuk anggota BGT!',
                badge: 'HOT',
                image: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400',
                gradient: 'promo-1',
                date: '25 Jan 2025'
            },
            {
                id: 2,
                title: 'Member Premium',
                desc: 'Fitur eksklusif untuk member!',
                badge: 'NEW',
                image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400',
                gradient: 'promo-2',
                date: '01 Feb 2025'
            },
            {
                id: 3,
                title: 'Tour Bareng',
                desc: 'Jalan-jalan bersama komunitas!',
                badge: 'EVENT',
                image: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=400',
                gradient: 'promo-3',
                date: '15 Feb 2025'
            },
            {
                id: 4,
                title: 'Cashback 10%',
                desc: 'Setiap transaksi dengan mitra BGT!',
                badge: 'PROMO',
                image: 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?w=400',
                gradient: 'promo-4',
                date: '28 Feb 2025'
            }
        ];

        let kopdarData = [
            {
                id: 1,
                title: 'Kopdar Bulanan Januari',
                date: '25 Jan 2025',
                time: '18:00 - 21:00',
                location: 'Warung Mak Beng, Sanur',
                image: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400',
                status: 'soon',
                attendees: 45
            },
            {
                id: 2,
                title: 'Makan Malam Bersama',
                date: '01 Feb 2025',
                time: '19:00 - 22:00',
                location: 'Jimbaran Beach Cafe',
                image: 'https://images.unsplash.com/photo-1555396273-367ea4eb4db5?w=400',
                status: 'open',
                attendees: 32
            },
            {
                id: 3,
                title: 'Tour ke Kintamani',
                date: '15 Feb 2025',
                time: '06:00 - 18:00',
                location: 'Kintamani, Bangli',
                image: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=400',
                status: 'open',
                attendees: 28
            }
        ];

        // Safe localStorage
        function safeGetItem(key) {
            try { return localStorage.getItem(key); } catch (e) { return null; }
        }

        function safeSetItem(key, value) {
            try { localStorage.setItem(key, value); return true; } catch (e) { return false; }
        }

        function safeRemoveItem(key) {
            try { localStorage.removeItem(key); } catch (e) {}
        }

        // Navigation - FULL SCREEN PAGES
        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById('page-' + page);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });

            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Menu Functions
        function openMenu() {
            document.getElementById('sideMenu').classList.add('active');
            document.getElementById('menuOverlay').classList.add('active');
        }

        function closeMenu() {
            document.getElementById('sideMenu').classList.remove('active');
            document.getElementById('menuOverlay').classList.remove('active');
        }

        // Share App
        function shareApp() {
            if (navigator.share) {
                navigator.share({
                    title: 'BGT-PRO',
                    text: 'Gabung komunitas PT. Bali Global Trans!',
                    url: window.location.href
                });
            } else {
                showToast('info', 'Bagikan', 'Link berhasil disalin!');
            }
        }

        // Toast Notification
        function showToast(type, title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            let iconClass = type === 'success' ? 'success' : type === 'warning' ? 'warning' : 'info';
            let iconName = type === 'success' ? 'fa-check' : type === 'warning' ? 'fa-exclamation' : 'fa-info';
            
            toast.innerHTML = `
                <div class="toast-icon ${iconClass}">
                    <i class="fas ${iconName}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Play sound if notification is enabled
            if (appSettings.notification) {
                playNotificationSound();
            }
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.classList.add('hiding');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Play notification sound
        function playNotificationSound() {
            const audio = document.getElementById('notifSound');
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log('Audio play failed'));
            }
        }

        // Load Settings
        function loadSettings() {
            try {
                const saved = localStorage.getItem('appSettings');
                if (saved) {
                    appSettings = JSON.parse(saved);
                }
            } catch (e) {}

            if ('Notification' in window && Notification.permission === 'granted') {
                appSettings.notification = true;
            }

            document.getElementById('toggleBackgroundLocation').checked = appSettings.backgroundLocation;
            document.getElementById('toggleHighAccuracy').checked = appSettings.highAccuracy;
            document.getElementById('toggleNotif').checked = appSettings.notification;

            updateNotificationStatus();
            updateSettingsBanner();
        }

        function updateNotificationStatus() {
            const toggleNotif = document.getElementById('toggleNotif');
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    toggleNotif.checked = true;
                    appSettings.notification = true;
                } else if (Notification.permission === 'denied') {
                    toggleNotif.checked = false;
                    appSettings.notification = false;
                }
            }
        }

        function saveSettings() {
            safeSetItem('appSettings', JSON.stringify(appSettings));
            updateSettingsBanner();
        }

        function updateSettingsBanner() {
            const banner = document.getElementById('settingsInfoBanner');
            if (appSettings.notification) {
                banner.className = 'info-banner success';
                banner.innerHTML = '<i class="fas fa-check-circle"></i> Notifikasi AKTIF - Anda akan menerima info terbaru';
            } else {
                banner.className = 'info-banner';
                banner.innerHTML = '<i class="fas fa-info-circle"></i> Aktifkan notifikasi untuk mendapat info terbaru';
            }
        }

        // Toggle Functions
        function toggleBackgroundLocation(enabled) {
            appSettings.backgroundLocation = enabled;
            saveSettings();
            stopLocationTracking();
            startLocationTracking();
            showToast('success', 'Background Location', enabled ? 'Diaktifkan' : 'Dinonaktifkan');
        }

        function toggleHighAccuracy(enabled) {
            appSettings.highAccuracy = enabled;
            saveSettings();
            stopLocationTracking();
            startLocationTracking();
            showToast('success', 'High Accuracy GPS', enabled ? 'Diaktifkan' : 'Dinonaktifkan');
        }

        async function toggleNotification(enabled) {
            if (enabled && 'Notification' in window) {
                if (Notification.permission === 'denied') {
                    showToast('warning', 'Notifikasi Diblokir', 'Buka pengaturan browser');
                    document.getElementById('toggleNotif').checked = false;
                    return;
                }
                if (Notification.permission !== 'granted') {
                    const result = await Notification.requestPermission();
                    if (result !== 'granted') {
                        document.getElementById('toggleNotif').checked = false;
                        showToast('warning', 'Izin Ditolak', 'Notifikasi tidak diizinkan');
                        return;
                    }
                }
            }
            appSettings.notification = enabled;
            saveSettings();
            showToast('success', 'Notifikasi', enabled ? 'Diaktifkan dengan suara' : 'Dinonaktifkan');
            if (enabled) {
                playNotificationSound();
            }
        }

        // Location Functions
        function startLocationTracking() {
            if (!navigator.geolocation) return;

            if (watchPositionId) {
                navigator.geolocation.clearWatch(watchPositionId);
            }

            let lastLat = 0, lastLng = 0;

            watchPositionId = navigator.geolocation.watchPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const user = auth.currentUser;

                    if (!user) return;

                    const distance = Math.sqrt(
                        Math.pow((lat - lastLat) * 111000, 2) +
                        Math.pow((lng - lastLng) * 111000, 2)
                    );

                    if (distance >= 10 || (lastLat === 0 && lastLng === 0)) {
                        lastLat = lat;
                        lastLng = lng;

                        try {
                            await db.collection('users').doc(user.uid).update({
                                latitude: lat,
                                longitude: lng,
                                locationUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            updateLocationUI(lat, lng);

                        } catch (error) {
                            console.error('Error updating location:', error);
                        }
                    }
                },
                (error) => console.log('Watch error:', error.message),
                {
                    enableHighAccuracy: appSettings.highAccuracy,
                    timeout: 30000,
                    maximumAge: 10000
                }
            );
        }

        function updateLocationUI(lat, lng) {
            document.getElementById('latValue').textContent = lat.toFixed(6);
            document.getElementById('lngValue').textContent = lng.toFixed(6);
            document.getElementById('locationTime').textContent = new Date().toLocaleTimeString('id-ID');

            const statusEl = document.getElementById('locationStatus');
            statusEl.classList.remove('inactive');
            statusEl.classList.add('active');
            document.getElementById('locationStatusText').textContent = 'Aktif';

            document.getElementById('statLocation').textContent = 'Aktif';
        }

        function stopLocationTracking() {
            if (watchPositionId) {
                navigator.geolocation.clearWatch(watchPositionId);
                watchPositionId = null;
            }
        }

        async function updateLocation() {
            const btn = document.getElementById('btnUpdateLocation');
            const btnText = document.getElementById('btnLocationText');

            btn.disabled = true;
            btnText.textContent = 'Mendapatkan lokasi...';

            if (!navigator.geolocation) {
                showToast('warning', 'Error', 'Browser tidak mendukung geolokasi');
                btn.disabled = false;
                btnText.textContent = 'Update Lokasi';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const user = auth.currentUser;

                    if (!user) return;

                    try {
                        await db.collection('users').doc(user.uid).update({
                            latitude: lat,
                            longitude: lng,
                            locationUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        updateLocationUI(lat, lng);

                        showToast('success', 'Lokasi Update', 'Koordinat berhasil diperbarui');

                        btnText.textContent = 'Berhasil!';
                        setTimeout(() => {
                            btnText.textContent = 'Update Lokasi';
                            btn.disabled = false;
                        }, 2000);
                    } catch (error) {
                        showToast('warning', 'Error', 'Gagal mengupdate lokasi');
                        btn.disabled = false;
                        btnText.textContent = 'Update Lokasi';
                    }
                },
                (error) => {
                    let msg = 'Gagal mendapatkan lokasi';
                    if (error.code === error.PERMISSION_DENIED) msg = 'Izin lokasi ditolak';
                    showToast('warning', 'Error', msg);
                    btn.disabled = false;
                    btnText.textContent = 'Update Lokasi';
                },
                { enableHighAccuracy: false, timeout: 10000, maximumAge: 60000 }
            );
        }

        // Session Monitor
        function startSessionMonitor(user) {
            if (!user) return;

            const userRef = db.collection('users').doc(user.uid);
            const localSessionId = safeGetItem('userSessionId');

            userSessionUnsubscribe = userRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    if (data.currentSessionId && localSessionId && data.currentSessionId !== localSessionId) {
                        if (userSessionUnsubscribe) userSessionUnsubscribe();
                        safeRemoveItem('userSessionId');
                        showToast('warning', 'Login Ganda', 'Akun login di perangkat lain');
                        auth.signOut();
                        window.location.href = 'index.html';
                    }
                }
            });

            updateLastActive();
            lastActiveInterval = setInterval(updateLastActive, 30000);
        }

        async function updateLastActive() {
            const user = auth.currentUser;
            if (!user) return;
            try {
                await db.collection('users').doc(user.uid).update({
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error('Error updating lastActive:', error);
            }
        }

        // Visibility change
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                updateLastActive();
            }
        });

        // Permission Functions
        function checkPermissions() {
            const asked = safeGetItem('permissionsAsked');
            if (!asked) {
                document.getElementById('permissionOverlay').style.display = 'flex';
            } else {
                const saved = safeGetItem('permissionStatus');
                if (saved) {
                    try {
                        permissionStatus = JSON.parse(saved);
                    } catch (e) {}
                }
            }
        }

        function showPermissionOverlay() {
            document.getElementById('permissionOverlay').style.display = 'flex';
            updatePermissionUI();
        }

        function hidePermissionOverlay() {
            document.getElementById('permissionOverlay').style.display = 'none';
            safeSetItem('permissionsAsked', 'true');
            safeSetItem('permissionStatus', JSON.stringify(permissionStatus));
        }

        function updatePermissionUI() {
            ['location', 'notification'].forEach(name => {
                updatePermItem(name, permissionStatus[name]);
            });
        }

        function updatePermItem(name, status) {
            const item = document.getElementById('perm-' + name);
            const statusEl = document.getElementById('status-' + name);
            if (!item || !statusEl) return;

            item.classList.remove('granted', 'denied');
            statusEl.classList.remove('granted', 'denied', 'pending');

            if (status === 'granted') {
                item.classList.add('granted');
                statusEl.classList.add('granted');
                statusEl.textContent = 'Diizinkan';
            } else if (status === 'denied') {
                item.classList.add('denied');
                statusEl.classList.add('denied');
                statusEl.textContent = 'Ditolak';
            } else {
                statusEl.classList.add('pending');
                statusEl.textContent = 'Menunggu';
            }
        }

        async function requestAllPermissions() {
            const btn = document.getElementById('btnRequestPermissions');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Meminta Izin...';

            try {
                // Location
                await new Promise((resolve) => {
                    if (!navigator.geolocation) {
                        permissionStatus.location = 'denied';
                        resolve();
                        return;
                    }
                    navigator.geolocation.getCurrentPosition(
                        (pos) => { permissionStatus.location = 'granted'; resolve(); },
                        () => { permissionStatus.location = 'denied'; resolve(); },
                        { timeout: 10000 }
                    );
                });

                // Notification
                if ('Notification' in window) {
                    const result = await Notification.requestPermission();
                    permissionStatus.notification = result === 'granted' ? 'granted' : 'denied';
                }

            } catch (error) {
                console.error('Permission error:', error);
            }

            updatePermissionUI();
            safeSetItem('permissionStatus', JSON.stringify(permissionStatus));

            const granted = Object.values(permissionStatus).filter(s => s === 'granted').length;
            if (granted >= 1) {
                btn.innerHTML = '<i class="fas fa-check"></i> Berhasil!';
                btn.style.background = 'var(--success)';
                showToast('success', 'Izin Diberikan', 'Semua izin berhasil diaktifkan');
                if (appSettings.notification) {
                    playNotificationSound();
                }
                setTimeout(hidePermissionOverlay, 1500);
            } else {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-check-circle"></i> Coba Lagi';
            }
        }

        function skipPermissions() {
            hidePermissionOverlay();
        }

        // Load Promo Data with AUTO SCROLL
        function loadPromoData() {
            const sliderHome = document.getElementById('promoSliderHome');
            
            // Duplicate promo data for infinite scroll effect
            const allPromos = [...promoData, ...promoData];
            
            sliderHome.innerHTML = allPromos.map(promo => `
                <div class="promo-card ${promo.gradient}" onclick="navigateTo('promo')">
                    <span class="promo-badge">${promo.badge}</span>
                    <h4 class="promo-title">${promo.title}</h4>
                    <p class="promo-desc">${promo.desc}</p>
                    <img src="${promo.image}" alt="${promo.title}" class="promo-image" loading="lazy">
                </div>
            `).join('');

            // Full list
            const listFull = document.getElementById('promoListFull');
            listFull.innerHTML = promoData.map(promo => `
                <div class="promo-item">
                    <img src="${promo.image}" alt="${promo.title}" class="promo-item-image" loading="lazy">
                    <div class="promo-item-content">
                        <h4 class="promo-item-title">${promo.title}</h4>
                        <p class="promo-item-desc">${promo.desc}</p>
                        <div class="promo-item-footer">
                            <span class="promo-item-date"><i class="fas fa-calendar"></i> ${promo.date}</span>
                            <button class="promo-item-btn">Lihat Detail</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load Kopdar Data
        function loadKopdarData() {
            const html = kopdarData.map(kopdar => `
                <div class="kopdar-card">
                    <img src="${kopdar.image}" alt="${kopdar.title}" class="kopdar-image" loading="lazy">
                    <div class="kopdar-info">
                        <h4 class="kopdar-title">${kopdar.title}</h4>
                        <div class="kopdar-meta">
                            <span><i class="fas fa-calendar"></i> ${kopdar.date}</span>
                            <span><i class="fas fa-clock"></i> ${kopdar.time}</span>
                        </div>
                        <span class="kopdar-badge ${kopdar.status}">${kopdar.status === 'soon' ? 'Coming Soon' : 'Open Registration'}</span>
                    </div>
                </div>
            `).join('');

            document.getElementById('kopdarListHome').innerHTML = html;
            document.getElementById('kopdarListFull').innerHTML = html;
        }

        // Load Notifications
        function loadNotifications() {
            const notifications = [
                {
                    title: 'Selamat Datang!',
                    message: 'Terima kasih telah bergabung di komunitas BGT-PRO',
                    time: 'Baru saja',
                    icon: 'fa-hand-wave',
                    type: 'info'
                },
                {
                    title: 'Kopdar Bulanan',
                    message: 'Jangan lupa daftar untuk kopdar bulan ini!',
                    time: '1 jam lalu',
                    icon: 'fa-calendar',
                    type: 'success'
                },
                {
                    title: 'Promo Spesial',
                    message: 'Dapatkan diskon 20% untuk anggota BGT!',
                    time: '2 jam lalu',
                    icon: 'fa-tag',
                    type: 'warning'
                }
            ];

            const list = document.getElementById('notificationList');
            list.innerHTML = notifications.map(notif => `
                <div class="notif-card">
                    <div class="notif-icon" style="background: rgba(99, 102, 241, 0.15); color: var(--primary);">
                        <i class="fas ${notif.icon}"></i>
                    </div>
                    <div class="notif-info">
                        <h4 class="notif-title">${notif.title}</h4>
                        <p class="notif-message">${notif.message}</p>
                        <span class="notif-time">${notif.time}</span>
                    </div>
                </div>
            `).join('');
        }

        // Listen for new notifications from admin
        function listenForNotifications() {
            const user = auth.currentUser;
            if (!user) return;

            notificationsUnsubscribe = db.collection('notifications')
                .where('targetUsers', 'array-contains', user.uid)
                .orderBy('createdAt', 'desc')
                .limit(10)
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach((change) => {
                        if (change.type === 'added') {
                            const data = change.doc.data();
                            // Show toast notification
                            if (appSettings.notification) {
                                showToast('info', data.title || 'Notifikasi Baru', data.message || '');
                            }
                        }
                    });

                    // Update badge
                    const badge = document.getElementById('notifBadge');
                    if (snapshot.size > 0) {
                        badge.classList.remove('hidden');
                        badge.textContent = snapshot.size > 9 ? '9+' : snapshot.size;
                    } else {
                        badge.classList.add('hidden');
                    }
                }, (error) => {
                    console.log('Notification listener error:', error);
                });
        }

        // Auth State
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            const localSessionId = safeGetItem('userSessionId');

            try {
                const doc = await db.collection('users').doc(user.uid).get();

                if (doc.exists) {
                    const data = doc.data();

                    if (!localSessionId || (data.currentSessionId && data.currentSessionId !== localSessionId)) {
                        safeRemoveItem('userSessionId');
                        auth.signOut();
                        showToast('warning', 'Sesi Berakhir', 'Login kembali');
                        window.location.href = 'index.html';
                        return;
                    }

                    showUserData(data);
                    startSessionMonitor(user);
                    listenForNotifications();
                } else {
                    showToast('warning', 'Error', 'Data user tidak ditemukan');
                    auth.signOut();
                    window.location.href = 'index.html';
                }
            } catch (error) {
                console.error("Error:", error);
            }
        });

        function showUserData(data) {
            // Hide loading
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainApp').style.display = 'block';

            // Avatar URLs
            const avatarUrl = data.profilePicUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(data.nama)}&background=6366f1&color=fff&size=200`;
            
            // Set all avatars
            document.getElementById('userAvatar').src = avatarUrl;
            document.getElementById('menuAvatar').src = avatarUrl;
            document.getElementById('profileAvatarLarge').src = avatarUrl;

            // Names
            document.getElementById('userName').textContent = data.nama || '-';
            document.getElementById('menuName').textContent = data.nama || '-';
            document.getElementById('profileName').textContent = data.nama || '-';

            // Titles
            document.getElementById('userTitle').textContent = data.titel || 'ANGGOTA';
            document.getElementById('menuTitle').textContent = data.titel || 'ANGGOTA';
            document.getElementById('profileTitle').textContent = data.titel || 'ANGGOTA';

            // Profile details
            document.getElementById('profileEmail').textContent = data.email || '-';
            document.getElementById('profilePhone').textContent = data.telepon || '-';
            document.getElementById('profilePlat').textContent = data.platMobil || '-';
            document.getElementById('profileJoined').textContent = data.bergabung || '-';

            // Status
            document.getElementById('userStatus').textContent = 'ONLINE';

            // Location
            if (data.latitude && data.longitude) {
                updateLocationUI(data.latitude, data.longitude);
                if (data.locationUpdatedAt) {
                    const date = data.locationUpdatedAt.toDate ? data.locationUpdatedAt.toDate() : new Date(data.locationUpdatedAt);
                    document.getElementById('locationTime').textContent = date.toLocaleTimeString('id-ID');
                }
            } else {
                document.getElementById('statLocation').textContent = 'Off';
            }

            // Load counts
            loadMemberCount();

            // Load promo & kopdar
            loadPromoData();
            loadKopdarData();
            loadNotifications();

            // Check permissions
            checkPermissions();

            // Load settings
            loadSettings();

            // Start location tracking
            startLocationTracking();
        }

        async function loadMemberCount() {
            try {
                const snapshot = await db.collection('users').get();
                document.getElementById('statMembers').textContent = snapshot.size;
                document.getElementById('statEvents').textContent = kopdarData.length;
            } catch (error) {
                console.error('Error loading member count:', error);
            }
        }

        // Logout
        async function handleLogout() {
            if (!confirm('Apakah Anda yakin ingin keluar?')) return;

            try {
                stopLocationTracking();

                if (lastActiveInterval) {
                    clearInterval(lastActiveInterval);
                    lastActiveInterval = null;
                }

                if (notificationsUnsubscribe) {
                    notificationsUnsubscribe();
                }

                const user = auth.currentUser;
                if (user) {
                    await db.collection('users').doc(user.uid).update({
                        currentSessionId: null,
                        lastActive: null,
                        status: 'OFFLINE'
                    });
                }

                if (userSessionUnsubscribe) userSessionUnsubscribe();
                safeRemoveItem('userSessionId');
                await auth.signOut();

                window.location.href = 'index.html';
            } catch (error) {
                console.error("Logout error:", error);
            }
        }
    </script>

</body>
</html>
